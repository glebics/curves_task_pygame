# Curves Task Pygame

## Описание

Данное приложение построено на библиотеке [PyGame](https://www.pygame.org/news) и позволяет пользователю создавать и анимировать гладкие кривые на основе опорных точек. Пользователь может добавлять точки, изменять количество точек сглаживания, ставить и снимать паузу, а также просматривать справку по доступным командам.

## Установка

Следуйте нижеприведённым шагам для развёртывания приложения:

1. **Перейдите на рабочий стол:**
    ```bash
    cd Desktop
    ```

2. **Создайте новую директорию для проекта и перейдите в неё:**
    ```bash
    mkdir curves_task_pygame
    cd curves_task_pygame
    ```

3. **Создайте виртуальное окружение:**
    ```bash
    python3 -m venv env
    ```

4. **Активируйте виртуальное окружение:**
    ```bash
    source env/bin/activate
    ```
    После активации вы увидите `(env)` в начале строки терминала.

5. **Создайте файл с зависимостями и добавьте в него необходимые библиотеки:**
    ```bash
    touch req.txt
    nano req.txt
    ```
    В открывшемся редакторе добавьте строку:
    ```
    pygame
    ```
    Сохраните и закройте редактор (в `nano` это `Ctrl + X`, затем `Y` и `Enter`).

6. **Создайте файл с основным кодом приложения:**
    ```bash
    touch main.py
    nano main.py
    ```
    Вставьте в `main.py` предоставленный код приложения (см. [Код Приложения](#код-приложения)).

7. **Установите зависимости:**
    ```bash
    pip install -r req.txt
    ```
    Вы увидите вывод установки PyGame и предупреждение о доступной новой версии `pip`. Вы можете проигнорировать его или обновить `pip` по желанию.

8. **Запустите приложение:**
    ```bash
    python main.py
    ```

## Использование

После запуска приложения откроется окно, в котором доступны следующие команды управления:

- **<F1>**: Показать/скрыть справку по командам
- **<R>**: Рестарт — очистить все опорные точки
- **<P>**: Пауза/Снятие паузы — остановить или запустить движение кривой
- **<Num+>** или **<+>**: Увеличить количество точек сглаживания
- **<Num->** или **<->**: Уменьшить количество точек сглаживания
- **Левая кнопка мыши**: Добавить опорную точку

Текущее количество точек сглаживания отображается в верхнем левом углу экрана и обновляется при изменении.

### Пошаговое руководство:

1. **Добавление опорных точек:**
    - Кликните левой кнопкой мыши в любом месте окна программы, чтобы добавить опорные точки. Добавьте как минимум три точки для построения кривой.

2. **Запуск движения кривой:**
    - Нажмите клавишу **<P>**, чтобы начать движение кривой. При этом опорные точки начнут двигаться, а кривая будет анимирована.

3. **Изменение количества точек сглаживания:**
    - Нажимайте клавиши **<Num+>** или **<+>** для увеличения количества точек сглаживания, что сделает кривую более плавной.
    - Нажимайте клавиши **<Num->** или **<->** для уменьшения количества точек сглаживания, что сделает кривую менее гладкой.

4. **Просмотр справки:**
    - Нажмите клавишу **<F1>**, чтобы отобразить экран справки с доступными командами.

5. **Рестарт приложения:**
    - Нажмите клавишу **<R>**, чтобы очистить все опорные точки и начать заново.

6. **Выход из приложения:**
    - Нажмите клавишу **<ESC>**, чтобы выйти из программы.

## Структура кода

### Классы

1. **Vec2d**
    - **Назначение:** Представляет 2-мерный вектор и обеспечивает основные математические операции.
    - **Методы:**
        - `__add__`, `__sub__`, `__mul__`, `__rmul__`: Операторы для сложения, вычитания и умножения векторов.
        - `__len__`: Возвращает длину вектора как целое число.
        - `int_pair`: Возвращает координаты вектора как кортеж из двух целых чисел.
        - `copy`: Возвращает копию вектора.

2. **Polyline**
    - **Назначение:** Представляет замкнутую ломаную, состоящую из опорных точек и их скоростей.
    - **Методы:**
        - `add_point`: Добавляет опорную точку с случайной скоростью.
        - `set_points`: Обновляет позиции опорных точек на основе их скоростей и обрабатывает отскок от границ экрана.
        - `draw_points`: Отрисовывает опорные точки или ломаную на экране.
        - `clear`: Очищает все опорные точки и скорости.

3. **Knot (наследник Polyline)**
    - **Назначение:** Представляет гладкую кривую (узел), построенную на основе опорных точек.
    - **Дополнительные атрибуты:**
        - `curve`: Список точек гладкой кривой.
    - **Методы:**
        - `add_point`: Добавляет опорную точку и перерасчитывает кривую.
        - `set_points`: Обновляет позиции опорных точек и перерасчитывает кривую.
        - `calculate_curve`: Рассчитывает точки гладкой кривой на основе опорных точек и заданного количества сглаживающих точек (`count`).
        - `get_point`: Рекурсивный метод для расчёта точки на кривой методом линейной интерполяции.
        - `draw_curve`: Отрисовывает гладкую кривую на экране.
        - `clear`: Очищает опорные точки, скорости и кривую.

4. **App**
    - **Назначение:** Управляет основным циклом приложения, обработкой событий и отрисовкой.
    - **Методы:**
        - `__init__`: Инициализирует Pygame, создаёт объекты `Knot`, устанавливает начальные параметры.
        - `run`: Запускает основной цикл приложения.
        - `handle_events`: Обрабатывает события пользователя (нажатия клавиш, клики мыши и т.д.).
        - `update`: Обновляет состояние приложения (перерасчитывает позиции точек и кривую, если программа не на паузе).
        - `draw`: Отрисовывает все элементы на экране (опорные точки, кривую, справку, количество точек сглаживания).
        - `draw_help`: Отрисовывает экран справки с доступными командами.

### Основные функции

- **add_point**
    - Добавляет новую опорную точку с случайной скоростью и перерасчитывает кривую.

- **set_points**
    - Обновляет позиции опорных точек на основе их скоростей, обеспечивая отскок от границ экрана.

- **calculate_curve**
    - Рассчитывает точки гладкой кривой на основе текущих опорных точек и заданного количества точек сглаживания.

- **get_point**
    - Рекурсивно вычисляет точку на кривой методом линейной интерполяции.

- **draw_curve**
    - Отрисовывает рассчитанную гладкую кривую на экране.

## Код Приложения

Полный код приложения находится в файле `main.py`. Ниже приведены ключевые части кода с пояснениями:

```python
class Vec2d:
    """Класс для работы с 2-мерными векторами."""

    def __init__(self, x, y):
        """Инициализация вектора с координатами x и y."""
        self.x = x
        self.y = y

    def __add__(self, other):
        """Сложение двух векторов."""
        return Vec2d(self.x + other.x, self.y + other.y)

    def __sub__(self, other):
        """Вычитание двух векторов."""
        return Vec2d(self.x - other.x, self.y - other.y)

    def __mul__(self, k):
        """Умножение вектора на скаляр."""
        if isinstance(k, (int, float)):
            return Vec2d(self.x * k, self.y * k)
        else:
            raise NotImplementedError("Умножение на данный тип не поддерживается.")

    def __rmul__(self, k):
        """Умножение скаляра на вектор."""
        return self.__mul__(k)

    def __len__(self):
        """Возвращает длину вектора как целое число."""
        return int(math.hypot(self.x, self.y))

    def int_pair(self):
        """Возвращает координаты вектора как кортеж из двух целых чисел."""
        return (int(self.x), int(self.y))

    def copy(self):
        """Возвращает копию вектора."""
        return Vec2d(self.x, self.y)

